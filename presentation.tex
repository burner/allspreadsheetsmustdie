\documentclass[aspectratio=169,notes]{beamer}
\usepackage{lmodern}
\usepackage{adjustbox}
\usepackage[T1]{fontenc}
\usepackage{textcomp}
\usepackage{animate}
\usepackage{underscore}
\usepackage{pdfpc-commands}
\usepackage{xmpmulti}
\usepackage{multimedia}
\usepackage{epstopdf}
\usepackage{bbding}
\usepackage{hyperref}
\usepackage{scalerel}
\def\thumbup{\scalerel*{\includegraphics{thumbup.png}}{O}}
\usepackage{listings}
\lstdefinelanguage{D}
{
  % list of keywords
  morekeywords={ abstract, alias, align, asm, assert, auto, body, bool, break,
	byte, case, cast, catch, cdouble, cent, cfloat, char, class, const,
	continue, double, else, enum, export, extern, false, final, finally,
	float, for, foreach, foreach_reverse, function, goto, idouble, if, ifloat,
	immutable, import, in, inout, int, interface, invariant, ireal, is, lazy,
	long, mixin, module, new, nothrow, null, out, override, package, pragma,
	private, protected, public, pure, real, ref, return, scope, shared, short,
	static, string, struct, super, switch, synchronized, template, this, throw,
	true, try, typeid, typeof, ubyte, ucent, uint, ulong, union,
	unittest, delegate, @safe
	ushort, version, void, wchar, while, with, __FILE__, __FILE_FULL_PATH__,
	__MODULE__, __LINE__, __FUNCTION__, __PRETTY_FUNCTION__, __gshared,
	__traits, __vector, __parameters
  },
  sensitive=false, % keywords are not case-sensitive
  morecomment=[l]{//}, % l is for line comment
  morecomment=[s]{/*}{*/}, % s is for start and end delimiter
  morecomment=[s]{/+}{+/}, % s is for start and end delimiter
  morestring=[b]" % defines that strings are enclosed in double quotes
}
\usepackage{color}
\definecolor{eclipseBlue}{RGB}{42,0.0,255}
\definecolor{eclipseGreen}{RGB}{63,127,95}
\definecolor{eclipsePurple}{RGB}{127,0,85}

% Set Language
\lstset{
  language={D},
  basicstyle=\small\ttfamily, % Global Code Style
  captionpos=b, % Position of the Caption (t for top, b for bottom)
  extendedchars=true, % Allows 256 instead of 128 ASCII characters
  tabsize=2, % number of spaces indented when discovering a tab 
  columns=fixed, % make all characters equal width
  keepspaces=true, % does not ignore spaces to fit width, convert tabs to spaces
  showstringspaces=false, % lets spaces in strings appear as real spaces
  breaklines=true, % wrap lines if they don't fit
  numbers=left, % show line numbers at the left
  numberstyle=\tiny\ttfamily, % style of the line numbers
  commentstyle=\color{eclipseGreen}, % style of comments
  keywordstyle=\color{eclipsePurple}, % style of keywords
  stringstyle=\color{eclipseBlue}, % style of strings
}
\definecolor{lightgray}{rgb}{.9,.9,.9}
\definecolor{darkgray}{rgb}{.4,.4,.4}
\definecolor{purple}{rgb}{0.65, 0.12, 0.82}
\lstdefinelanguage{TypeScript}{
	keywords={break, case, catch, continue, debugger, default, delete, do, else,
		false, finally, for, function, if, in, instanceof, new, null, return, switch,
		this, throw, true, try, typeof, var, void, while, with, interface,
		class, export, boolean, throw, implements, import, this, const, let,
		of, =>},
	morecomment=[l]{//},
	morecomment=[s]{/*}{*/},
	morestring=[b]',
	morestring=[b]",
	ndkeywords={},
	keywordstyle=\color{blue}\bfseries,
	ndkeywordstyle=\color{darkgray}\bfseries,
	identifierstyle=\color{black},
	commentstyle=\color{purple}\ttfamily,
	stringstyle=\color{red}\ttfamily,
	sensitive=true
}

\colorlet{punct}{red!60!black}
\definecolor{background}{HTML}{EEEEEE}
\definecolor{delim}{RGB}{20,105,176}
\colorlet{numb}{magenta!60!black}

\lstdefinelanguage{GraphQL}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    stepnumber=1,
    showstringspaces=false,
    breaklines=true,
	keywords={type, schema, mutation, subscription, __type, __schema, kind},
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}

\lstdefinelanguage{json}{
    basicstyle=\normalfont\ttfamily,
    numbers=left,
    stepnumber=1,
    showstringspaces=false,
    breaklines=true,
    literate=
     *{0}{{{\color{numb}0}}}{1}
      {1}{{{\color{numb}1}}}{1}
      {2}{{{\color{numb}2}}}{1}
      {3}{{{\color{numb}3}}}{1}
      {4}{{{\color{numb}4}}}{1}
      {5}{{{\color{numb}5}}}{1}
      {6}{{{\color{numb}6}}}{1}
      {7}{{{\color{numb}7}}}{1}
      {8}{{{\color{numb}8}}}{1}
      {9}{{{\color{numb}9}}}{1}
      {:}{{{\color{punct}{:}}}}{1}
      {,}{{{\color{punct}{,}}}}{1}
      {\{}{{{\color{delim}{\{}}}}{1}
      {\}}{{{\color{delim}{\}}}}}{1}
      {[}{{{\color{delim}{[}}}}{1}
      {]}{{{\color{delim}{]}}}}{1},
}
\usepackage{tikz}
\usetikzlibrary{shadows}
\usepackage{xkeyval}
\usepackage{todonotes}
\presetkeys{todonotes}{inline}{}
\defbeamertemplate{description item}{align left}{\insertdescriptionitem\hfill}
\usetheme{metropolis}					 % Use metropolis theme
\usepackage[
    backend=biber,
    url=true, 
	style=numeric,
    doi=true,
    eprint=false
]{biblatex}
\addbibresource{biblatex-examples.bib}

\title{All Spreadsheets must Die}
\date{\today}
\author{Robert Schadek}
\begin{document}
	\maketitle

	\section{Getting started}
	\begin{frame}{A random list of languages we love to hate}
		\begin{itemize}
			\item Rust
			\item Go
			\item C++
			\item JavaScript
			\item Typescript
		\end{itemize}
		\todo{replace itemize with logos}
	\end{frame}

	\note[itemize]{
		\item There are all these languages we like to hate.
		\item Many of them are good, many are more popular.
		\item Many might even be better.
		\item But we are missing something
	}

	\begin{frame}{Hating by numbers}
		\begin{description}
			\item[C++] $4.4 Million$ (2015)
			\item[C] $1.9 Million$ (2015)
			\item[Java] $9 Million$ (2009)	
			\item[JS] $10 Million$ (2018)
		\end{description}
	\end{frame}
	
	\begin{frame}
		\begin{center}
		\huge
		These are all small fish\\[2cm]
		\pause
		\textbf{Excel} $750 Million$ (2016)
		\end{center}
	\end{frame}

	\begin{frame}[fragile]
		\begin{center}
		\includegraphics[width=0.6\textwidth]{skepical.jpg}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{Oh, but it is \hfill{} \cite{GOTO201638:online}}
		\begin{center}
		\includegraphics[width=1.0\textwidth]{functionalexcel.jpg}
		\end{center}
	\end{frame}

	\section{A little bit of Spreadsheet bashing}
	\begin{frame}[fragile]{See the code is difficult}
		\begin{center}
		\includegraphics[width=1.0\textwidth]{excelseeingcode.jpg}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{Dynamic Types}
		\begin{center}
		\includegraphics[width=1.0\textwidth]{exceldynamic.jpg}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{Dynamic Types}
		\begin{center}
		\includegraphics[width=1.0\textwidth]{exceldynamic2.jpg}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{Dynamic Types}
		\begin{center}
		\includegraphics[width=1.0\textwidth]{exceldynamic3.jpg}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]
		\begin{center}
		\includegraphics[width=0.6\textwidth]{boyholdingfart.jpg}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{git blame}
		\begin{center}
			\huge
			git blame\\[2cm]
			\pause
			\large
			lets not go there\footnote{we will just become sad}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{Code refactoring}
		\begin{itemize}
			\item \lstinline@=SUM(1,2)@ \pause
			\item equal, identifier, lparen, int(1), comma, int(2), comma, int(3), rparen
			\item set excel locale to de\_DE
			\item \lstinline@=SUM(1,2)@ \pause
			\item equal, identifier, lparen, float(1.2), rparen
		\end{itemize}
	\end{frame}

	\begin{frame}[fragile]{Bits and pieces}
		\begin{itemize}
			\item Knowledge silos
			\item Slow	
			\item No separation between data and code
			\item Access management $\dots$ anybody
		\end{itemize}
	\end{frame}

	\begin{frame}[fragile]{(Typical) Spreadsheet Lifecycle}
		\begin{enumerate}
			\item Create private shopping spreadsheet
			\item Show spreadsheet to college 
			\item Use spreadsheet for all company purchases
			\item Put web frontend on spreadsheet backend
			\item Pivot company to become commerce company
		\end{enumerate}	
		\begin{tikzpicture}[remember picture,overlay]
		    \node[drop shadow,xshift=75mm,yshift=-38mm,rotate=-15,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu.jpg}};
			\pause
		    \node[drop shadow,xshift=35mm,yshift=-38mm,rotate=15,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu2.jpg}};
			\pause
		    \node[drop shadow,xshift=75mm,yshift=-38mm,rotate=-35,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu3.jpg}};
			\pause
		    \node[drop shadow,xshift=75mm,yshift=-38mm,rotate=35,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu4.jpg}};
			\pause
		    \node[drop shadow,xshift=40mm,yshift=-33mm,rotate=15,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu5.jpg}};
			\pause
		    \node[drop shadow,xshift=55mm,yshift=-18mm,rotate=15,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu6.jpg}};
			\pause
		    \node[drop shadow,xshift=55mm,yshift=-28mm,rotate=5,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu7.jpg}};
			\pause
		    \node[drop shadow,xshift=35mm,yshift=-28mm,rotate=-17,anchor=north west] 
				at (current page.north west){\includegraphics[width=50mm]{snafu8.jpg}};
			\pause
		    \node[drop shadow,xshift=35mm,yshift=-08mm,rotate=0,anchor=north west] 
				at (current page.north west){\includegraphics[width=90mm]{snafu9.jpg}};
		\end{tikzpicture}
	\end{frame}
	
	\begin{frame}
		\begin{center}
			\huge
			\textbf{Spreadsheets rule the world!}
		\end{center}
	\end{frame}
	
	\begin{frame}{How you should be feeling right now}
		\begin{center}
    		\inlineMovie[loop&autostart&start=0&stop=12]{kermit.mpg}{kermit-0.png}{height=0.9\textheight}
		\end{center}
	\end{frame}

	\begin{frame}{Two assumptions going forward}
		\begin{itemize}
			\item You believe that spreadsheets rule the world.
			\item You actually want D to rule the world.
		\end{itemize}
	\end{frame}

	\begin{frame}{\mbox{}}
		\begin{center}
			\huge
			How are we going to win this?\\[2cm]
			\pause
			We are not!
		\end{center}
	\end{frame}

	\section{Lets draw up a battle plan}

	\begin{frame}{Lets take stock of what we have}
		\begin{itemize}
			\item Too many spreadsheets \pause \CheckmarkBold
			\item Too many tasks \pause \CheckmarkBold
			\item Too little man-power \pause \CheckmarkBold
			\item Millions of lines of source in different languages \pause \CheckmarkBold
			\item D's powerful Compile-Time (CT) features \pause \CheckmarkBold
		\end{itemize}
	\end{frame}

	\begin{frame}{Possible Attack Vectors}
		\begin{center}
		\includegraphics[width=0.8\textwidth]{attackvectors.eps}
		\end{center}
	\end{frame}

	\section{How to work with limited man-power}

	\begin{frame}{Leveraging existing libraries}
		Writing data to spreadsheets
		\begin{itemize}
			\item Is required, people will ask for that
			\item Writing a somewhat feature complete xlsx writer is a huge task
		\end{itemize}
		\mbox{}\\[1cm]
		\begin{itemize}
			\item libxlsxwriter is a feature (complete) xlsx writer
			\item Wrapping it by hand, no way (+78000 lines of structs, enums and functions)
			\item dpp to the rescue
			\item libxlsxwriter.d (+4000 lines)
			\item But it is still a C api
		\end{itemize}
	\end{frame}

	\begin{frame}[fragile]{dpp output}
		\begin{lstlisting}[language=D]
void chart_axis_set_name(lxw_chart_axis*, const(char)*)
void chart_axis_set_name_range(lxw_chart_axis*, const(char)*, lxw_row_t, lxw_col_t)
void chart_axis_set_name_font(lxw_chart_axis*, lxw_chart_font*)
void chart_axis_set_num_font(lxw_chart_axis*, lxw_chart_font*)
void chart_axis_set_num_format(lxw_chart_axis*, const(char)*)
void chart_axis_set_line(lxw_chart_axis*, lxw_chart_line*)
void chart_axis_set_fill(lxw_chart_axis*, lxw_chart_fill*)
void chart_axis_set_pattern(lxw_chart_axis*, lxw_chart_pattern*)
void chart_axis_set_reverse(lxw_chart_axis*)
void chart_axis_set_crossing(lxw_chart_axis*, double)
void chart_axis_set_crossing_max(lxw_chart_axis*)
void chart_axis_off(lxw_chart_axis*)
		\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{semi-automatic refactoring}
		\begin{lstlisting}[language=D]
struct ChartAxis {
	lxw_chart_axis* handle;

	void setName(string name) { 
		chart_axis_set_name(this.handle, toStringz(name)); 
	}

	void setNameRange(string name, lxw_row_t row, 
			lxw_col_t col) 
	{
		chart_axis_set_name(this.handle, toStringz(name), row, col
			);
	}
	...
}
		\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{Creating fake data}
		Problem to solve: We needed fake data of people.
		\begin{itemize}
			\item Name
			\item Address
			\item i18n
			\item ...
		\end{itemize}	
		\pause
		\begin{tikzpicture}[remember picture,overlay]
		    \node[xshift=10mm,yshift=-0mm,rotate=0,anchor=north west] 
				at (current page.north west)
				{\includegraphics[width=1.0\textwidth]{lovetrianglefaker.jpg}};
		\end{tikzpicture}
	\end{frame}

	\begin{frame}[fragile]{faker.js}
		\includegraphics[width=0.2\textwidth]{fakerjs.png}
		\begin{itemize}
			\item $+160$ attributes
			\item $39$ languages
		\end{itemize}
	\end{frame}

	\begin{frame}[fragile]{faker.js}
		\begin{lstlisting}[language=Java,caption={locales/de/name/name.js}]
module["exports"] = [
  "#{prefix} #{first_name} #{last_name}",
  "#{first_name} #{nobility_title_prefix} #{last_name}",
  "#{first_name} #{last_name}",
  "#{first_name} #{last_name}",
  "#{first_name} #{last_name}",
  "#{first_name} #{last_name}"
];\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{FakeD}
\begin{lstlisting}[language=D,basicstyle=\tiny\ttfamily]
override string nameName() {
	switch(uniform(0, 6, this.rnd)) {
		case 0:
			return format("%s %s %s", namePrefix(), nameFirstName(), nameLastName());
		case 1:
			return format("%s %s %s", nameFirstName(), nameNobilityTitlePrefix(), nameLastName());
		case 2:
			return format("%s %s", nameFirstName(), nameLastName());
		case 3:
			return format("%s %s", nameFirstName(), nameLastName());
		case 4:
			return format("%s %s", nameFirstName(), nameLastName());
		case 5:
			return format("%s %s", nameFirstName(), nameLastName());
		default: assert(false);
	}
}
\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{FakeD}
\begin{lstlisting}[language=D]
import faked;

auto f = new Faker(1337);
writeln(f.nameName());

// localized to german
f = new Faker_de(1338);
writeln(f.nameName());
\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{FakeD}
		\begin{itemize}
			\item Parser and Generator script $\approx 1500$ lines
			\item A workday of manual labor
			\item Output feature equivalent $\approx 70000$ lines faker.js clone
			\item Most changes in faker.js just require a tool rerun to update
		\end{itemize}
		\pause
		Bonus:
		\begin{itemize}
			\item Created to PRs to faker.js fixing wrong template expansion	
		\end{itemize}
	\end{frame}

	\section{Taking a step back}
	\begin{frame}[fragile]{The starting point}
\begin{columns}
\begin{column}{0.35\textwidth}
\begin{lstlisting}[language=D,basicstyle=\scriptsize\ttfamily]
class Employee {
	long id;
	DateTime createdAd;

	EmployeeInfo info;
	long infoId;
}	

class EmployeeInfo {
	long id;
	string firstname;
	string lastname;

	Salary salary;
	long salaryId;
}	
\end{lstlisting}
\end{column}
\begin{column}{0.35\textwidth}
\begin{lstlisting}[language=D,basicstyle=\scriptsize\ttfamily,firstnumber=17]
class Salary {
	long id;
	Employee createdBy;
	long createdById;

	CurrencyAmount amount;
	long amountId;
}

class CurrencyAmount {
	long id;
	double amount;

	Currency currency;
	long currencyId;
}
\end{lstlisting}
\end{column}
\begin{column}{0.25\textwidth}
\begin{lstlisting}[language=D,basicstyle=\scriptsize\ttfamily,firstnumber=32]
class Currency {
	long id;
	string name;
}
\end{lstlisting}
\end{column}
\end{columns}
	\end{frame}

	\begin{frame}[fragile]{The vibe.d REST interface}
\begin{lstlisting}[language=D]
interface Backend {
	Employee[] getAllEmployees();
	Employee getEmployee(long empId);
	EmployeeInfo getEmployeeInfo(long empInfoId);
	Salary getSalary(long salaryId);
	CurrencyAmount getCurrencyAmount(long currencyAmountId);
	Currency getCurrency(long currencyId);
}
\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{The Wanted Output: Salary Table}
		\begin{center}
		\begin{tabular}{l | l | r | l | l}
			Firstname & Lastname & Amount & Currency & CreatedBy \\ \hline
			Hans & Meier & 73331 & USD & Ruth Ember \\
			John & Doe & 83431 & GPB & Ruth Ember \\
			Ruth & Ember & 103431 & EUR & Hans Meier \\
		\end{tabular}	
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{The Frontend Code: Types}
\begin{columns}
\begin{column}{0.35\textwidth}
\begin{lstlisting}[language=typescript,basicstyle=\scriptsize\ttfamily]
interface Employee {
	id: number;
	createdAd: number;

	info?: EmployeeInfo;
	infoId: number;
}	

interface EmployeeInfo {
	id: number;
	firstname: string;
	lastname: string;

	salary?: Salary;
	salaryId: number;
}	
\end{lstlisting}
\end{column}
\begin{column}{0.35\textwidth}
\begin{lstlisting}[language=TypeScript,basicstyle=\scriptsize\ttfamily,firstnumber=17]
interface Salary {
	id: number;
	createdBy?: Employee;
	createdById: number;

	amount?: CurrencyAmount;
	amountId: number;
}

interface CurrencyAmount {
	id: number;
	amount: number;

	currency?: Currency;
	currencyId: number;
}
\end{lstlisting}
\end{column}
\begin{column}{0.25\textwidth}
\begin{lstlisting}[language=TypeScript,basicstyle=\scriptsize\ttfamily,firstnumber=32]
interface Currency {
	id: number;
	name: string;
}
\end{lstlisting}
\end{column}
\end{columns}
	\end{frame}

	\begin{frame}[fragile]{The Frontend Code: Backend Service}
\begin{lstlisting}[language=TypeScript,basicstyle=\scriptsize\ttfamily,tabsize=4]
import { 
	Employee, EmployeeInfo, Salary, CurrencyAmount, Currency 
} from "model";

class Backend {
	getAllEmployees() : Employee[] { ... }
	getEmployee(empId: number): Employee { ... }
	getEmployeeInfo(empInfoId: number): EmployeeInfo { ... }
	getSalary(salaryId: number): Salary { ... }
	getCurrencyAmount(currencyAmountId: number): CurrencyAmount { ... }
	getCurrency(currencyId: number): Currency { ... }
}
\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{The Frontend Code: Calling the Backend}
\begin{lstlisting}[language=TypeScript,basicstyle=\scriptsize\ttfamily,tabsize=2]
this.backend.getAllEmployees().pipe(
	mergeMap((emps: Employee[]) => {
		const obs = [];
		for(const emp of emps) {
			obs.push(this.backend.getEmployeeInfo(emp.infoId)
				.pipe(map((empInfo: EmployeeInfo) => {
						const ne: Employee = {...emp, info : empInfo};
						return ne;
					})
				)
			);
		}
		return forkJoin(obs);
	}),
	mergeMap((emps: Employee[]) => {
		const obs = [];
		for(const emp of emps) {
			obs.push(this.backend.getSalary(emp.info.salaryId)
				.pipe(map((sal: Salary) => {
						const ne: Employee = {...emp};
						ne.info.salary = sal;
						return ne;
					})
				)
			);
		}
		return forkJoin(obs);
	}),
\end{lstlisting}
\end{frame}

	\begin{frame}[fragile]{The Communication}
		\begin{center}
			\includegraphics[height=0.9\textheight]{restbackend.eps}
		\end{center}
	\end{frame}
	
	\begin{frame}[fragile]{The Conclusion}
		\begin{itemize}
			\item Clearly, this is unworkable
			\item Not plastic at all
			\item Just a lot of boring work
		\end{itemize}
	\end{frame}

	\begin{frame}{The real Conclusion}
		\begin{center}
    		\inlineMovie[loop&autostart&start=0&stop=10]{keyboard.mpg}{keyboard-0.png}{height=0.9\textheight}
		\end{center}
	\end{frame}

	\begin{frame}{So, what do we want?}
		\begin{itemize}
			\item Declare how we want the data to look when we get it
			\item Data should be Json
		\end{itemize}
	\end{frame}

	\begin{frame}[fragile]{Why can't we write this?}
		\vspace{-7mm}	
		\begin{columns}[t]
			\begin{column}{0.5\textwidth}
				\begin{lstlisting}[language=json,basicstyle=\scriptsize\ttfamily]
{
	allEmployees {
		info {
			firstname
			lastname
			salary {
				amount
				currency {
					name
				}
			}
			createdBy {
				info {
					firstname
					lastname
				}
			}
		}
	}
}
\end{lstlisting}	
			\end{column}
			\begin{column}{0.5\textwidth}
				\begin{lstlisting}[language=json,basicstyle=\scriptsize\ttfamily]
{
	allEmployees: [ { 
			info: {
				firstname: "Hans",
				lastname: "Meier",
				salary: {
					amount: 73331,
					currency: {
						name: "USD"
					}
				}
			},
			createdBy: {
				info: {
					firstname: "Ruth",
					lastname: "Ember"
				}
			}
		},
		...
	]
}
\end{lstlisting}	
			\end{column}
			
		\end{columns}
	\end{frame}

	\begin{frame}{GraphQL}
		\begin{center}
			\includegraphics[height=0.9\textheight]{graphql.eps}	
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{GraphQL}
		\hspace{2mm}%
		\begin{columns}[t]
			\begin{column}{0.38\textwidth}
		\begin{lstlisting}[language=GraphQL,basicstyle=\scriptsize\ttfamily]
schema {
	query: Backend
}

type Backend {
	getAllEmployees: [Employee]
}

type Employee {
	id: number!;
	createdAd: number!;

	info: EmployeeInfo;
}	
\end{lstlisting}
			\end{column}
			\begin{column}{0.33\textwidth}
		\begin{lstlisting}[language=GraphQL,basicstyle=\scriptsize\ttfamily,firstnumber=15]
type EmployeeInfo {
	id: number!;
	firstname: String!;
	lastname: String!;
	salary: Salary;
}	

type Salary {
	id: number!;
	createdBy: Employee;
	amount: CurrencyAmount;
}
\end{lstlisting}
			\end{column}

			\begin{column}{0.29\textwidth}
		\begin{lstlisting}[language=GraphQL,basicstyle=\scriptsize\ttfamily,firstnumber=27]
type CurrencyAmount {
	id: number!;
	amount: number!;
	currency: Currency;
}
type Currency {
	id: number!;
	name: string!;
}
\end{lstlisting}
			\end{column}
		\end{columns}
\end{frame}

	\begin{frame}[fragile]{Introspecting Types}
		\vspace{-7mm}	
		\begin{columns}[t]
			\begin{column}{0.5\textwidth}
				\begin{lstlisting}[language=json,basicstyle=\scriptsize\ttfamily]
{
	__type(name: "Employee") {
		name
		fields {
			name
			type {
				name
				kind
				ofType {
					name
				}
			}
		}
	}
}
\end{lstlisting}	
			\end{column}
			\begin{column}{0.5\textwidth}
				\begin{lstlisting}[language=json,basicstyle=\scriptsize\ttfamily]
{
	"data": {
		"__type": {
			"name": "Employee",
			"fields": [
				{
					"name": "id",
					"type": {
						"name": null,
						"kind": "NON_NULL",
						"ofType" {
							"name": "INT"
						}
					}
				},
				{
					"name": "info",
					"type": {
						"name": "EmployeeInfo",
						"kind": "OBJECT"
					}
				}
			]
		}
	}
}
\end{lstlisting}	
			\end{column}
			
		\end{columns}
	\end{frame}

	\begin{frame}[fragile]{D's GraphQL Story}
		\begin{center}
			\includegraphics{graphqlsearch.jpg}	
		\end{center}	
	\end{frame}

	\begin{frame}{JUST DO IT}
		\begin{center}
    		\inlineMovie[loop&autostart&start=0&stop=10]{justdoit.mpg}{justdoit-0.png}{height=0.9\textheight}
		\end{center}
	\end{frame}

	\begin{frame}[fragile]{GraphQLD}
		\begin{columns}[t]
			\begin{column}{0.4\textwidth}
\begin{lstlisting}[language=D,basicstyle=\scriptsize\ttfamily]
import graphqld;

interface Query {
	Employee[] getAllEmployees();
}

class Schema {
	Query queryType;
}
\end{lstlisting}
			\end{column}
	\pause
			\begin{column}{0.6\textwidth}
\begin{lstlisting}[language=D,basicstyle=\scriptsize\ttfamily]
auto graphqld = new GraphQLD!(Schema)();
graphqld.setResolver(
  "queryType", "getAllEmployees",
  delegate(string name, Json parent, 
      Json args, ref Context context) @safe
  {
    enforce(context.auth.isLoggedIn());
    Employee[] employees = getAllEmployees();
    Json ret = Json.emptyObject();
    ret["data"] = toGraphqlJson(employees);
    return ret;
  });
\end{lstlisting}
			\end{column}
		\end{columns}
	\end{frame}

	\begin{frame}[fragile]{GraphQLD}
\begin{lstlisting}[language=D,basicstyle=\small\ttfamily]
void graphqlEndpoint(HTTPServerRequest req, 
		HTTPServerResponse res) 
{
	string toParse = extractQuery(req);
	Json vars = extractVariables(req);
	auto p = Parser(Lexer(toParse));

	Document d = p.parseDocument();
	StaticValidator fv = new StaticValidator(d);
	fv.accept(d);

	Context context = buildContext(req);
	Json ret = graphqld.execute(d, vars, context);
	res.writeJsonBody(ret);
}
\end{lstlisting}
	\end{frame}

	\begin{frame}[fragile]{Homework}
		\begin{center}
			Write a GraphQL backend that uses an excel spreadsheet as a database.
		\end{center}
	\end{frame}

	\section{Conclusion}
	\begin{frame}[fragile]{Conclusion}
		\begin{itemize}
			\item Spreadsheets must die.
			\item We need to learn to use what is there.
			\item GraphQL \thumbup{}
		\end{itemize}
	\end{frame}
\end{document}
